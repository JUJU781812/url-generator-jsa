<script>
// --- CAS SPÉCIAUX BIOGRAPHIE (on saute la question "Site / Acuity")
const bioLinks = {
  'Inscription Newsletter': {
    long: 'https://www.chevalblanc-patrimoine.fr/pages/inscription-emailing/',
    short: 'https://shorturl.re/7httb'
  },
  'Prise de rendez-vous': {
    long: 'https://chevalblancpatrimoine.as.me/?appointmentType=15105353&field:13761652=linkedin&field:13824495=social&field:15813253=post_joachim',
    short: 'https://shorturl.re/7glsu'
  }
};

// --- LIENS EXISTANTS (Acuity)
const links = {
  "Post": {
    "Stratégie": { "short": "https://shorturl.re/7glsu", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=15105353" },
    "Assurance vie luxembourgeoise": { "short": "https://shorturl.re/7glsv", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=68705748" },
    "équipe Sud-Ouest": { "short": "https://shorturl.re/7glsw", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=69809186" },
    "Loi Malraux et monument historique": { "short": "https://shorturl.re/7glsx", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=24153643" },
    "Private Equity": { "short": "https://shorturl.re/7glsc", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=26168218" },
    "FCPI": { "short": "https://shorturl.re/7glsd", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=523544" },
    "SCPI": { "short": "https://shorturl.re/7glse", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=111677851" },
    "Immobilier neuf": { "short": "https://shorturl.re/7glsf", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=68705752" },
    "Nue-propriété": { "short": "https://shorturl.re/7glsg", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=68705753" },
    "Investir en immobilier": { "short": "https://shorturl.re/7glsi", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=68705755" },
    "Maîtriser sa fiscalité": { "short": "https://shorturl.re/7glsj", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=68705757" },
    "Cession d'actif immobilier": { "short": "https://shorturl.re/7glsk", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=523544" },
    "Inscription Newsletter": { "short": "https://bit.ly/4h6ydIA", "long": "https://www.chevalblanc-patrimoine.fr/pages/inscription-newsletter" }
  },
  "Biographie": {
    "Prise de rendez-vous": { "short": "https://shorturl.re/7glsb", "long": "https://chevalblancpatrimoine.as.me/?appointmentType=523544" },
    "Inscription Newsletter": { "short": "https://bit.ly/4kg6vMq", "long": "https://www.chevalblanc-patrimoine.fr/pages/inscription-newsletter" }
  }
};

// --- LIENS SITE
const siteLinks = {
  "Post": {
    "Stratégie": { long: "https://www.chevalblanc-patrimoine.fr/conseil-ingenierie/votre-bilan-patrimonial-offert/", short: "https://www.chevalblanc-patrimoine.fr/conseil-ingenierie/votre-bilan-patrimonial-offert/" },
    "Assurance vie luxembourgeoise": { long: "https://www.chevalblanc-patrimoine.fr/financier/les-meilleures-assurance-vie-luxembourgeoise/", short: "https://www.chevalblanc-patrimoine.fr/financier/les-meilleures-assurance-vie-luxembourgeoise/" },
    "équipe Sud-Ouest": { long: "https://www.chevalblanc-patrimoine.fr/bureau-sud-ouest/", short: "https://www.chevalblanc-patrimoine.fr/bureau-sud-ouest/" },
    "Loi Malraux et monument historique": { long: "https://www.chevalblanc-patrimoine.fr/immobilier/investir-avec-la-loi-monuments-historiques/", short: "https://www.chevalblanc-patrimoine.fr/immobilier/investir-avec-la-loi-monuments-historiques/" },
    "Private Equity": { long: "https://www.chevalblanc-patrimoine.fr/financier/investir-en-private-equity/", short: "https://www.chevalblanc-patrimoine.fr/financier/investir-en-private-equity/" },
    "FCPI": { long: "https://www.chevalblanc-patrimoine.fr/financier/investir-en-fcpi/", short: "https://www.chevalblanc-patrimoine.fr/financier/investir-en-fcpi/" },
    "SCPI": { long: "https://www.chevalblanc-patrimoine.fr/immobilier/optimiser-son-investissement-en-scpi/", short: "https://www.chevalblanc-patrimoine.fr/immobilier/optimiser-son-investissement-en-scpi/" },
    "Immobilier neuf": { long: "https://www.chevalblanc-patrimoine.fr/immobilier/programmes-immobiliers/", short: "https://www.chevalblanc-patrimoine.fr/immobilier/programmes-immobiliers/" },
    "Nue-propriété": { long: "https://www.chevalblanc-patrimoine.fr/immobilier/investir-en-nue-propriete/", short: "https://www.chevalblanc-patrimoine.fr/immobilier/investir-en-nue-propriete/" },
    "Investir en immobilier": { long: "https://www.chevalblanc-patrimoine.fr/immobilier/", short: "https://www.chevalblanc-patrimoine.fr/immobilier/" },
    "Maîtriser sa fiscalité": { long: "https://www.chevalblanc-patrimoine.fr/conseil-ingenierie/maitriser-ma-fiscalite/", short: "https://www.chevalblanc-patrimoine.fr/conseil-ingenierie/maitriser-ma-fiscalite/" },
    "Cession d'actif immobilier": { long: "https://www.chevalblanc-patrimoine.fr/conseil-ingenierie/votre-bilan-patrimonial-offert/", short: "https://www.chevalblanc-patrimoine.fr/conseil-ingenierie/votre-bilan-patrimonial-offert/" },
    "Inscription Newsletter": { long: "https://www.chevalblanc-patrimoine.fr/pages/inscription-newsletter", short: "https://www.chevalblanc-patrimoine.fr/pages/inscription-newsletter" }
  },
  "Biographie": {}
};

// --- FONCTIONS PRINCIPALES

function updateSecondQuestion() {
  const emp = document.getElementById("emplacement").value;
  const secondDiv = document.getElementById("second-question");
  document.getElementById("third-question").innerHTML = "";
  document.getElementById("fourth-question").innerHTML = "";
  document.getElementById("result").innerHTML = "";
  secondDiv.innerHTML = "";
  if (!emp) return;

  const options = Object.keys(links[emp] || {});
  let html = `<label for='theme'>${emp === 'Post' ? "Quelle est la thématique de ton post ?" : "Quel type de lien veux-tu ?"}</label>`;
  html += `<select id='theme' onchange='afterTheme()'><option value=''>-- Sélectionner --</option>`;
  options.forEach(t => { html += `<option value='${t}'>${t}</option>`; });
  html += `</select>`;
  secondDiv.innerHTML = html;
}

function afterTheme() {
  const emp = document.getElementById("emplacement").value;
  const theme = document.getElementById("theme").value;
  const fourthDiv = document.getElementById("fourth-question");
  document.getElementById("third-question").innerHTML = "";
  document.getElementById("result").innerHTML = "";
  fourthDiv.innerHTML = "";
  if (!theme) return;

  if (emp === 'Biographie' && (theme in bioLinks)) {
    fourthDiv.innerHTML = `<input type="hidden" id="destType" value="bio">`;
    askForLinkType();
    return;
  }
  askForDestination();
}

function askForDestination() {
  const theme = document.getElementById("theme").value;
  if (!theme) return;
  const fourthDiv = document.getElementById("fourth-question");
  document.getElementById("third-question").innerHTML = "";
  document.getElementById("result").innerHTML = "";
  fourthDiv.innerHTML = `
    <label for='destType'>Tu veux une redirection vers le site internet ou vers le planning de RDV (Acuity) ?</label>
    <select id='destType' onchange='askForLinkType()'>
      <option value=''>-- Sélectionner --</option>
      <option value='site'>Site internet</option>
      <option value='acuity'>Planning RDV (Acuity)</option>
    </select>
  `;
}

function askForLinkType() {
  const dest = document.getElementById("destType").value;
  if (!dest) return;
  const thirdDiv = document.getElementById("third-question");
  document.getElementById("result").innerHTML = "";
  thirdDiv.innerHTML = `
    <label for='linkType'>Tu veux une URL courte ou longue ?</label>
    <select id='linkType' onchange='displayLink()'>
      <option value=''>-- Sélectionner --</option>
      <option value='short'>Courte</option>
      <option value='long'>Longue</option>
    </select>
  `;
}

function displayLink() {
  const emp = document.getElementById("emplacement").value;
  const theme = document.getElementById("theme").value;
  const type = document.getElementById("linkType").value;
  const destEl = document.getElementById("destType");
  const dest = destEl ? destEl.value : '';
  const resultDiv = document.getElementById("result");
  if (!emp || !theme || !type) return;

  let url = '';
  if (emp === 'Biographie' && (theme in bioLinks)) {
    url = bioLinks[theme]?.[type] || '';
  } else {
    let map;
    if (dest === 'acuity') map = links;
    else map = siteLinks;
    url = map?.[emp]?.[theme]?.[type] || '';
  }

  if (url) {
    resultDiv.innerHTML = `
      <label style='display:block;margin-bottom:0.5rem;'>Voici ton lien :</label>
      <input id='finalUrl' type='text' value='${url}' readonly onclick='this.select()'>
    `;
  } else {
    resultDiv.textContent = "Lien introuvable. Vérifie tes sélections.";
  }
}
</script>
